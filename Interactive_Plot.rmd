---
title: "Case Study 2: Employee Attrition"
author: "Drew Wilkins, Faiz Ikramulla, Samuel Kadyebo"
date: "November 24, 2018"
output:
  html_document:
    code_folding: hide
runtime: shiny
---

```{r echo=T, warning= FALSE, message= FALSE}
library(openxlsx)
library(shiny)
library(plotly)

# Load in the data
setwd("C:/Users/Andrew/Documents/Data Science Masters/Doing Data Science/Case Study 2/Case Study 2 Project/")
casestudy <- read.xlsx("Data/CaseStudy2-data.xlsx", sheet= 1, colNames= T)

# Columns 9, 10, 22, and 27 have no meaningful data.  Remove them.
casestudy <- casestudy[,-c(9, 10, 22, 27)]
parameters <- colnames(casestudy) # This will be used for the plot

shinyApp(
  ui <- fluidPage(
  h2("Exploratory Data Analysis"),
  h4("Change the vertical and horizontal axes to compare different parameters"),
  tags$ol(
    tags$li("The first dropdown is the vertical axis"),
    tags$li("The second dropdown is for the horizontal axis")
  ),
  
  # Vertical space
  tags$hr(),
  
  # Feature selection
  fixedRow(
    column(3, selectInput(inputId = "featureInput1", label = "Vertical axis", choices = parameters, selected = "MonthlyIncome")),
    column(4, selectInput(inputId = "featureInput2", label = "Horizontal axis", choices = parameters, selected = "JobRole"))),
  
  # First row
  fixedRow(
    column(6, plotlyOutput("Plot1", height = "500px", width= "500px")))),

server <- function(input, output){
  
  # Observes the second feature input for a change
  observeEvent(input$featureInput1,{
    
    # Create a convenience data.frame which can be used for charting
    plot.df <- data.frame(casestudy[,input$featureInput1],
                          casestudy[,input$featureInput2],
                          attrite <- casestudy$Attrition)
    # Add column names
    colnames(plot.df) <- c("vertical", "horizontal", "Attrition")
    
    # Define the color scheme
    pal <- c("blue", "red")
    pal <- setNames(pal, c("No", "Yes"))
    
    # Do a plotly contour plot to visualize the two featres with
    # the number of malignant cases as size
    # Note the use of 'source' argument
    output$Plot1 <- renderPlotly({
      plot_ly(plot.df, x = ~horizontal, y = ~vertical, mode = "markers",
              type = "scatter", color = ~attrite, colors= pal, source = "subset",
              marker = list(size = 5)) %>%
        config(displayModeBar = F) %>% # this removes the interactive toolbar
        layout(title = paste(input$featureInput1, "vs ", input$featureInput2),
               yaxis = list(title = input$featureInput1),
               xaxis = list(title = input$featureInput2))
    })

    
    # Assign to parent environment
    plot.df <<- plot.df
  })
  observeEvent(input$featureInput2,{
    
    # Create a convenience data.frame which can be used for charting
    plot.df <- data.frame(casestudy[,input$featureInput1],
                          casestudy[,input$featureInput2],
                          attrite <- casestudy$Attrition)
    
    # Add column names
    colnames(plot.df) <- c("vertical", "horizontal", "Attrition")
    
    # Define the color scheme
    pal <- c("blue", "red")
    pal <- setNames(pal, c("No", "Yes"))
    
    # Do a plotly contour plot to visualize the two featres with
    # the number of malignant cases as size
    # Note the use of 'source' argument
    output$Plot1 <- renderPlotly({
      plot_ly(plot.df, x = ~horizontal, y = ~vertical, mode = "markers",
              type = "scatter", color = ~attrite, colors= pal, source = "subset",
              marker = list(size = 5)) %>%
        config(displayModeBar = F) %>% # this removes the interactive toolbar
        layout(title = paste(input$featureInput1, "vs ", input$featureInput2),
               yaxis = list(title = input$featureInput1),
               xaxis = list(title = input$featureInput2))
    })
  })
},

options = list(height = 800)
  
)
```